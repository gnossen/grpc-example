import argparse
import logging
import sys

import grpc_kv_client


def get(args):
    print(grpc_kv_client.get(args.server, args.key))


def store(args):
    grpc_kv_client.store(args.server, args.key, args.value)


if __name__ == "__main__":
    logging.basicConfig(level=logging.INFO)
    parser = argparse.ArgumentParser(
        description="Client to an in-memory key-value store.")
    parser.add_argument(
        "--server",
        help="The server target to which to connect.",
        default="localhost:50051")
    subparsers = parser.add_subparsers(dest="subparser_name")
    store_parser = subparsers.add_parser(
        "store", help="Associate a value with a key.")
    store_parser.add_argument("key")
    store_parser.add_argument("value")
    store_parser.set_defaults(func=store)
    get_parser = subparsers.add_parser(
        "get", help="Get the value associated with a key.")
    get_parser.add_argument("key")
    get_parser.set_defaults(func=get)
    args = parser.parse_args()
    if 'func' not in args:
        parser.print_usage()
        sys.exit(1)
    args.func(args)
